- defaults:
    name: globals

- job-template:
    name: jenkins-userContent

    description:

    logrotate:
       daysToKeep: 7
       numToKeep: 10
       artifactDaysToKeep: -1
       artifactNumToKeep: -1

    scm:
    - git:
        url: '{git}'
        branches:
        - '{branch}'
        submodule:
          recursive: true
        skip-tag: true
        wipe-workspace: false

    triggers:
    - pollscm: "*/1 * * * *"

    builders:
    - shell: '
         npm install;
         grunt;
         cp userContent.{{css,js}} $JENKINS_HOME/userContent/;
         mkdir -p build/html;
         rst2html ReadMe.rst build/html/ReadMe.html;
       '

    wrappers:
    - timestamps
    - ansicolor:
         colormap: vga

    publishers:
    - logparser:
         parse-rules: /var/lib/jenkins/log-rules.txt
         unstable-on-warning: true
         fail-on-error: true
    - task-scanner:
         pattern: '*.styl,*.yaml,Gruntfile.js'
         health-threshold: low
         can-run-on-failed: true
         use-stable-build-as-reference: false
         use-delta-values: false
         should-detect-modules: false
         do-not-resolve-relative-paths: true
         dont-compute-new: true
    - email:
         notify-every-unstable: false
         send-to-individuals: true
         recipients: 'dev@dotmpe.com'
    - html-publisher:
         name: 'Project ReadMe'
         dir: build/html/
         files: ReadMe.html
         keep-all: false
         allow-missing: false


- project:
    name: jenkins-userContent

    jobs:
    - jenkins-userContent:
        display-name: '{title}'
        #title: 'Jenkins JS/CSS'
        description: !include-raw .jenkins-description.html
        git: 'git@github.com:dotmpe/jenkins-usercontent.git'
        branch: 'origin/master'
        build-summary-image: ws/logo.png
        build-config: jenkins-ci.yaml
        version: 0.0.2

