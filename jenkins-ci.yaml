- defaults:
    name: globals

    jenkins_home: /var/lib/jenkins
    failure-emailto: dev@dotmpe.com


- job-template:
    name: jenkins-userContent

    description:

    logrotate:
       daysToKeep: 7
       numToKeep: 10
       artifactDaysToKeep: -1
       artifactNumToKeep: -1

    scm:
    - git:
        url: '{git}'
        branches:
        - '{branch}'
        submodule:
          recursive: true
        skip-tag: true
        wipe-workspace: false

    triggers:
    - pollscm:
        cron: "*/1 * * * *"

    builders:
    - shell: |
        npm install
        grunt
        cp userContent.{css,js} $HOME/userContent/
        mkdir -p build/html
        rst2html ReadMe.rst build/html/ReadMe.html

    wrappers:
    - timestamps
    - ansicolor:
         colormap: css

    publishers:
    - logparser:
         parse-rules: '{jenkins_home}/log-rules.txt'
         unstable-on-warning: true
         fail-on-error: true
    - jtb-inline-tasks-parser:
         project-src: '*.styl,*.yaml,Gruntfile.js'
    - email:
         notify-every-unstable: false
         send-to-individuals: true
         recipients: '{failure-emailto}'
    - html-publisher:
         name: 'Project ReadMe'
         dir: build/html/
         files: ReadMe.html
         keep-all: false
         allow-missing: false


- project:
    name: jenkins-userContent

    node: master

    jobs:
    - jenkins-userContent:
        display-name: '{title}'
        git: 'https://github.com/dotmpe/jenkins-userContent.git'
        branch: 'origin/master'
        title: 'Jenkins JS/CSS'
        htmlDescription: "CSS/JS for Jenkins CI server UI. <a href='ws/build/html/ReadMe.html'>ReadMe</a>."
        build-summary-image: ws/logo.png
        build-config: jenkins-ci.yaml
        version: 0.0.2

